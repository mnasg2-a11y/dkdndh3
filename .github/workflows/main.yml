name: Persistent-VPS
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  secure-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 0
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Restore Data
        run: |
          mkdir -p $HOME/my_data
          echo "โ ุชู ุฅูุดุงุก ุฏููู ุงูุจูุงูุงุช"

      - name: Create SSH User & Configure
        run: |
          sudo apt update -y
          sudo apt install -y openssh-server
          sudo systemctl enable ssh
          sudo systemctl start ssh
          
          # ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ูุน ุตูุงุญูุงุช sudo
          sudo useradd -m -s /bin/bash githubuser
          echo "githubuser:GitHubVPS2024" | sudo chpasswd
          sudo usermod -aG sudo githubuser
          
          # ุฅุนุฏุงุฏุงุช SSH ุฃูุซุฑ ุฃูุงูุงู
          echo "PermitRootLogin no" | sudo tee -a /etc/ssh/sshd_config
          echo "PasswordAuthentication yes" | sudo tee -a /etc/ssh/sshd_config
          echo "AllowUsers githubuser" | sudo tee -a /etc/ssh/sshd_config
          
          sudo service ssh restart
          echo "โ SSH user: githubuser | pass: GitHubVPS2024"

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=persistent-vps --advertise-exit-node
          tsIP=$(tailscale ip -4 | head -n 1)
          echo "TAILSCALE_IP=$tsIP" >> $GITHUB_ENV
          echo "โ Tailscale IP: $tsIP"

      - name: Keep VPS Alive Forever
        run: |
          echo "========================================="
          echo "๐ VPS ุฌุงูุฒ ููุงุณุชุฎุฏุงู!"
          echo "๐ก Tailscale IP: $TAILSCALE_IP"
          echo "๐ฅ๏ธ  SSH: githubuser@$TAILSCALE_IP"
          echo "๐ ูููุฉ ุงููุฑูุฑ: GitHubVPS2024"
          echo "๐ ูููุณุชุฎุฏู ุตูุงุญูุงุช sudo ูุงููุฉ"
          echo "========================================="
          echo ""
          echo "โ ุงุณุชุฎุฏู ุงูุฃูุฑ ุงูุชุงูู ููุงุชุตุงู:"
          echo "ssh githubuser@$TAILSCALE_IP"
          echo ""
          echo "๐ ุจุนุฏ ุงูุงุชุตุงูุ ููููู ุงูุชุญูู ุจุงุณุชุฎุฏุงู:"
          echo "whoami  # ูุฌุจ ุฃู ูุธูุฑ: githubuser"
          echo "sudo -l  # ูุนุฑุถ ุตูุงุญูุงุช sudo"
          echo ""
          echo "[$(date)] ุจุฏุก ุงูุชุดุบูู..."
          
          # ุญููุฉ ูุง ููุงุฆูุฉ
          while true; do
            echo "[$(date)] VPS ูุดุท - IP: $TAILSCALE_IP"
            echo "   ๐ ููุงุชุตุงู: ssh githubuser@$TAILSCALE_IP"
            echo "   ๐ ูููุฉ ุงููุฑูุฑ: GitHubVPS2024"
            echo "   ---------------------------------"
            sleep 300  # ุชุญุฏูุซ ูู 5 ุฏูุงุฆู
          done
