name: Persistent-VPS
on:
  workflow_dispatch: # Ù„ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª ÙƒÙ„ Ø´Ù‡Ø±
  schedule:
    - cron: '0 */6 * * *' # ÙŠØ¹ÙŠØ¯ ØªØ´ØºÙŠÙ„ Ù†ÙØ³Ù‡ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©

jobs:
  secure-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 0 # ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù„Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø¨Ù‚Ø§Ø¡ Ø¯Ø§Ø¦Ù…Ù‹Ø§
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Restore Data
        run: |
          # Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† ÙØ±Ø¹ (branch) Ø®Ø§Øµ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          git config --global user.name "VPS-Bot"
          git config --global user.email "bot@vps.com"
          mkdir -p /root/my_data
          # Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø³ÙŠØªÙ… Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§

      - name: Install & Configure SSH
        run: |
          sudo apt update -y
          sudo apt install -y openssh-server
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo "root:admin@123" | sudo chpasswd
          echo "PermitRootLogin yes" | sudo tee -a /etc/ssh/sshd_config
          sudo service ssh restart
          echo "âœ… SSH user: root | pass: admin@123"

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=vps-${{ github.run_id }}
          tsIP=$(tailscale ip -4 | head -n 1)
          echo "TAILSCALE_IP=$tsIP" >> $GITHUB_ENV
          echo "âœ… Tailscale IP: $tsIP"

      - name: Background Auto-Save
        run: |
          # Ø³ÙƒØ±ÙŠØ¨Øª ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
          cat << 'EOF' > /save_data.sh
          while true; do
            echo "Saving data to GitHub..."
            # Ø£Ø¶Ù Ù‡Ù†Ø§ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ ØªØ­ÙØ¸ Ù…Ù„ÙØ§ØªÙƒ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
            sleep 600
          done
          EOF
          chmod +x /save_data.sh
          ./save_data.sh &

      - name: Keep VPS Alive Forever
        run: |
          echo "Tailscale VPS ready!"
          echo "IP: $TAILSCALE_IP"
          echo "SSH Connection:"
          echo "ssh root@$TAILSCALE_IP"
          echo "Password: admin@123"
          
          # Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø¨Ù‚Ø§Ø¡ Ø¯Ø§Ø¦Ù…Ù‹Ø§
          current_time=0
          while true; do
            echo "[$(date)] VPS running continuously... (Time: ${current_time} min)"
            echo "ğŸ“¡ Tailscale IP: $TAILSCALE_IP"
            echo "ğŸ”Œ SSH: ssh root@$TAILSCALE_IP"
            echo "ğŸ”‘ Password: admin@123"
            echo "---"
            sleep 60
            current_time=$((current_time + 1))
          done
